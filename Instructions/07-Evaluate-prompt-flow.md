---
lab:
  title: 生成 AI モデルのパフォーマンスを評価する
  description: モデルとプロンプトを評価して、チャット アプリのパフォーマンスと適切に応答する能力を最適化する方法について学習します。
---

# 生成 AI モデルのパフォーマンスを評価する

この演習では、手作業および自動の評価を使用して、Azure AI Foundry ポータルでモデルのパフォーマンスを評価します。

この演習には約 **30** 分かかります。

> **注**: この演習で使用されるテクノロジの一部は、プレビューの段階または開発中の段階です。 予期しない動作、警告、またはエラーが発生する場合があります。

## Azure AI Foundry ハブとプロジェクトを作成する

この演習で使用する Azure AI Foundry の機能には、Azure AI Foundry *ハブ* リソースに基づくプロジェクトが必要です。

1. Web ブラウザーで [Azure AI Foundry ポータル](https://ai.azure.com) (`https://ai.azure.com`) を開き、Azure 資格情報を使用してサインインします。 初めてサインインするときに開いたヒントまたはクイック スタート ウィンドウを閉じます。また、必要に応じて左上にある **Azure AI Foundry** ロゴを使用してホーム ページに移動します。それは次の画像のようになります (**[ヘルプ]** ウィンドウが開いている場合は閉じます)。

    ![Azure AI Foundry ポータルのスクリーンショット。](./media/ai-foundry-home.png)

1. ブラウザーで `https://ai.azure.com/managementCenter/allResources` に移動し、**[作成]** を選択します。 次に、新しい **AI ハブ リソース**を作成するオプションを選択します。
1. **[プロジェクトの作成]** ウィザードで、プロジェクトの有効な名前を入力します。既存のハブが推奨される場合は、新しいハブを作成するオプションを選択し、**[詳細オプション]** を展開してプロジェクトの以下の設定を指定します。
    - **[サブスクリプション]**:"*ご自身の Azure サブスクリプション*"
    - **リソース グループ**: *リソース グループを作成または選択します*
    - **ハブ名**: ハブの有効な名前
    - **場所**: 次のいずれかの場所を選択します (*演習の後半でクォータ制限を超えた場合は、別のリージョンに別のリソースを作成する必要が生じる可能性があります。*)
        - 米国東部 2
        - フランス中部
        - 英国南部
        - スウェーデン中部

    > **メモ**: ポリシーを使用して使用可能なリソース名を制限する Azure サブスクリプションで作業している場合は、**[新しいプロジェクトの作成]** ダイアログ ボックスの下部にあるリンクを使用して、Azure portal を使用してハブを作成する必要があります。

    > **ヒント**: **[作成]** ボタンが無効な場合は、ハブの名前を一意の英数字にしてください。

1. プロジェクトが作成されるまで待ちます。

## モデルをデプロイする

この演習では、GPT-4o-mini モデルのパフォーマンスを評価します。 また、GPT-4o モデルを使用して、AI 支援評価メトリックを生成します。

1. プロジェクトの左側のナビゲーション ウィンドウの **[マイ アセット]** セクションで、**[モデル + エンドポイント]** ページを選択します。
1. **[モデル + エンドポイント]** ページの **[モデル デプロイ]** タブの **[+ モデルのデプロイ]** メニューで、**[基本モデルのデプロイ]** を選択します。
1. 一覧で **GPT-4o** モデルを検索してから、それを選択して確認します。
1. デプロイの詳細で **[カスタマイズ]** を選択して、以下の設定でモデルをデプロイします。
    - **デプロイ名**: モデル デプロイの有効な名前**
    - **デプロイの種類**: グローバル標準
    - **バージョンの自動更新**: 有効
    - **モデルのバージョン**: *利用可能な最新バージョンを選択します*
    - **接続されている AI リソース**: *使用している Azure OpenAI リソース接続を選択します*
    - **1 分あたりのトークンのレート制限 (1,000)**: 50,000 *(または 50,000 未満の場合はサブスクリプションで使用可能な最大値)*
    - **コンテンツ フィルター**: DefaultV2

    > **注**:TPM を減らすと、ご利用のサブスクリプション内で使用可能なクォータが過剰に消費されることを回避するのに役立ちます。 この演習で使用するデータには、50,000 TPM で十分です。 使用可能なクォータがこれより低い場合は、演習を完了できますが、レート制限を超えるとエラーが発生する可能性があります。

1. デプロイが完了するまで待ちます。
1. **[モデル + エンドポイント]** ページに戻り、前の手順を繰り返して、同じ設定で **GPT-4o-mini** モデルをデプロイします。

## モデルを手作業で評価する

テスト データに基づいて、モデルの応答を手動で確認できます。 手作業で確認すると、さまざまな入力をテストして、モデルが期待どおりのパフォーマンスを見せるどうかを評価できます。

1. 新しいブラウザー タブで、`https://raw.githubusercontent.com/MicrosoftLearning/mslearn-ai-studio/refs/heads/main/data/travel_evaluation_data.jsonl` から [travel_evaluation_data.jsonl](https://raw.githubusercontent.com/MicrosoftLearning/mslearn-ai-studio/refs/heads/main/data/travel_evaluation_data.jsonl) をダウンロードし、ローカル フォルダーに **travel_evaluation_data.jsonl** として保存します (.txt ファイルではなく、必ず .jsonl ファイルとして保存してください)。
1. [Azure AI Foundry ポータル] タブに戻り、ナビゲーション ウィンドウの **[保護と管理]** セクションで、**[評価]** を選択します。
1. **[新しい評価の作成]** ウィンドウが自動的に開いた場合は、**[キャンセル]** を選択してウィンドウを閉じます。
1. **[評価]** ページで、**[手作業評価]** タブを表示し、**[+ 新しい手作業評価]** を選択します。
1. **[構成]** セクションの **[モデル]** 一覧で、お使いの **gpt-4o** モデル デプロイを選びます。
1. AI 旅行アシスタント用に**システム メッセージ**を次の指示に変更します。

   ```
   Assist users with travel-related inquiries, offering tips, advice, and recommendations as a knowledgeable travel agent.
   ```

1. **[手動評価の結果]** セクションで、**[テスト データのインポート]** を選択し、前にダウンロードした **travel_evaluation_data.jsonl** ファイルをアップロードしたあと、下にスクロールしてデータセット フィールドを次のようにマップします。
    - **入力**: 質問
    - **期待される応答**: ExpectedResponse
1. テスト ファイル内の質問と期待される回答を確認します。これらを使用して、モデルが生成する応答を評価します。
1. 上部のバーから **[実行]** を選択して、入力として追加したすべての質問の出力を生成します。 数分後に、次のように、モデルからの応答が新しい**出力**列に表示されます。

    ![Azure AI Foundry ポータルでの手作業評価ページのスクリーンショット。](./media/manual-evaluation.png)

1. 各質問に対する出力を確認し、モデルからの出力を期待される回答と比較し、各応答の右下にあるサムズアップまたはサムズダウンのアイコンを選択して結果を "採点" します。
1. 応答を採点したら、一覧の上にある概要タイルを確認します。 次にツール バーで、**[結果の保存]** を選択し、適切な名前を割り当てます。 結果を保存すると、後でそれらを取得して、さらに評価したり、別のモデルと比較したりすることができます。

## 自動評価を使用する

モデルの出力を自分の期待する応答と手作業で比較することは、モデルのパフォーマンスを評価する便利な方法ですが、さまざまな質問と回答が期待されるシナリオでは時間のかかるアプローチです。さまざまなモデルとプロンプトの組み合わせを比較するために使用できる標準化されたメトリックという形ではほとんど何も提供しません。

自動評価は、メトリックを計算し、AI を使用して一貫性、関連性、その他の要因に対する応答を評価することで、これらの欠点に対処しようとするアプローチです。

1. **[手作業評価]** ページ タイトルの横にある戻る矢印 (**&larr;**) を使用して、**[評価]** ページに戻ります。
1. **[自動評価]** タブを表示します。
1. **[新しい評価の作成]** を選択し、メッセージが表示されたら、**モデル**を評価するオプションを選択し、**[次へ]** を選択します。
1. **[データ ソースの選択]** ページで、**[データセットを使用する]** を選択し、前にアップロードしたファイルに応じて **travel_evaluation_data_jsonl_*xxxx...*** データセットを選択し、**[次へ]** を選択します。
1. **[モデルのテスト]** ページで、**gpt-4o-mini** モデルを選択し、**[システム メッセージ]** を、前に使用した AI 旅行アシスタント用の指示と同じものに変更します。

   ```
   Assist users with travel-related inquiries, offering tips, advice, and recommendations as a knowledgeable travel agent.
   ```

1. **[クエリ]** フィールドで、**\{\{item.question\}\}** を選択します。
1. **[次へ]** を選択して、次のページに進みます。
1. **[エバリュエータの構成]** ページで、**[+ 追加]** ボタンを使用して次のエバリュエータを追加し、それぞれを次のように構成します。
    - **モデル スコアラー**:
        - **基準名**: Semantic_similarity
        - **グレード対象**: ***gpt-4o** モデルを選択します*
        - **ユーザー** 設定 (下部):


            出力: \{\{sample.output_text\}\}<br>
            グラウンド トゥルース: \{\{item.ExpectedResponse\}\}<br>
            <br>
        
    - **リッカート尺度エバリュエータ**:
        - **基準名**: Relevance
        - **グレード対象**: ***gpt-4o** モデルを選択します*
        - **クエリ**: \{\{item.question\}\}

    - **テキストの類似性**:
        - **基準名**: F1_Score
        - **グラウンド トゥルース**: \{\{item.ExpectedResponse\}\}

    - **ヘイトフルで不公平なコンテンツ**:
        - **基準名**: Hate_and_unfairness
        - **クエリ**: \{\{item.question\}\}

1. **[次へ]** を選択して、評価設定を確認します。 旅行評価データセットを使用して、**gpt-4o-mini** モデルをセマンティックの類似性、関連性、F1 スコア、ヘイトフルで不公平な言葉づかいの観点で評価するように評価を構成したはずです。
1. 評価に適切な名前を付け、**[送信]** して評価プロセスを開始し、完了するまで待ちます。 これには数分かかることがあります。 ツール バーの **[最新の情報に更新]** ボタンを使用して、状態を確認できます。

1. 評価が完了したら、必要に応じて下にスクロールして結果を確認します。

    ![評価メトリックのスクリーンショット。](./media/ai-quality-metrics.png)

1. ページの上部にある **[データ]** タブを選択して、評価の生データを確認します。 データには、各入力のメトリックと、応答を評価するときに適用される GPT-4o モデルの理由の説明が含まれます。

## クリーンアップ

Azure AI Foundry を調べ終わったら、Azure の不要なコストを避けるため、作成したリソースを削除する必要があります。

- [Azure portal](https://portal.azure.com) (`https://portal.azure.com`) に移動します。
- Azure portal の **[ホーム]** ページで、**[リソース グループ]** を選択します。
- この演習のために作成したリソース グループを選びます。
- リソース グループの **[概要]** ページの上部で、**[リソース グループの削除]** を選択します。
- リソース グループ名を入力して、削除することを確認し、**[削除]** を選択します。
