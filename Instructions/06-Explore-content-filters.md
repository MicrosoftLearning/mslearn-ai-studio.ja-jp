---
lab:
  title: コンテンツ フィルターを適用して有害なコンテンツの出力を防ぐ
  description: 潜在的に不快または有害な出力を軽減するコンテンツ フィルターを生成 AI アプリで適用する方法について説明します。
---

# コンテンツ フィルターを適用して有害なコンテンツの出力を防ぐ

Azure AI Foundry には、不快感を与える可能性があるプロンプトと入力候補を識別し、サービスとの対話から削除するのに役立つ既定のコンテンツ フィルターが含まれています。 さらに、特定のニーズに合わせてカスタム コンテンツ フィルターを定義し、ご使用のモデル デプロイがご使用の生成 AI シナリオに適切な責任ある AI の原則を適用するようにできます。 コンテンツのフィルター処理は、生成 AI モデルを操作するときの責任ある AI に対する効果的なアプローチの 1 要素です。

この演習では、Azure AI Foundry の既定のコンテンツ フィルターの効果を確認します。

この演習には、約 **25** 分かかります。

> **注**: この演習で使用されるテクノロジの一部は、プレビューの段階または開発中の段階です。 予期しない動作、警告、またはエラーが発生する場合があります。

## Azure AI Foundry プロジェクトを作成する

まず、Azure AI Foundry プロジェクトを作成します。

1. Web ブラウザーで [Azure AI Foundry ポータル](https://ai.azure.com) (`https://ai.azure.com`) を開き、Azure 資格情報を使用してサインインします。 初めてサインインするときに開いたヒントまたはクイック スタート ウィンドウを閉じます。また、必要に応じて左上にある **Azure AI Foundry** ロゴを使用してホーム ページに移動します。それは次の画像のようになります。

    ![Azure AI Foundry ポータルのスクリーンショット。](./media/ai-foundry-home.png)

1. ホーム ページで、**[+ 作成]** を選択します。
1. **[プロジェクトの作成]** ウィザードで、有効なプロジェクト名を入力し、既存のハブが推奨された場合は、新しいハブを作成するオプションを選択します。 次に、ハブとプロジェクトをサポートするために自動的に作成される Azure リソースを確認します。
1. **[カスタマイズ]** を選択し、ハブに次の設定を指定します。
    - **ブ名**: *ハブの有効な名前*
    - **[サブスクリプション]**:"*ご自身の Azure サブスクリプション*"
    - **リソース グループ**: *リソース グループを作成または選択します。*
    - **場所**: 次のいずれかのリージョンを選択します\*:
        - 米国東部
        - 米国東部 2
        - 米国中北部
        - 米国中南部
        - スウェーデン中部
        - 米国西部
        - 米国西部 3
    - **Azure AI サービスまたは Azure OpenAI への接続**: *新しい AI サービス リソースを作成します*
    - **Azure AI 検索への接続**:接続をスキップする

    > \* 執筆時点で、この演習で使用する Microsoft *Phi-4* モデルは、これらのリージョンで使用できます。 [Azure AI Foundry のドキュメント](https://learn.microsoft.com/azure/ai-foundry/how-to/deploy-models-serverless-availability#region-availability)で、特定のモデルの最新のリージョン別の使用可能性を確認できます。 演習の後半でクォータ制限に達した場合は、別のリージョンに別のリソースを作成する必要が生じる可能性があります。

1. **[次へ]** を選択し、構成を確認します。 **[作成]** を選択し、プロセスが完了するまで待ちます。
1. プロジェクトが作成されたら、表示されているヒントをすべて閉じて、Azure AI Foundry ポータルのプロジェクト ページを確認します。これは次の画像のようになっているはずです。

    ![Azure AI Foundry ポータルの Azure AI プロジェクトの詳細のスクリーンショット。](./media/ai-foundry-project.png)

## モデルをデプロイする

これでモデルをデプロイする準備が整いました。 この演習では *Phi-4* モデルを使用しますが、これから探索するコンテンツ フィルターの原則と手法は、他のモデルにも適用できます。

1. Azure AI Foundry プロジェクト ページの右上にあるツール バーで、**[プレビュー機能]** (**&#9215**) アイコンを使用して、**[Azure AI モデル推論サービスにモデルをデプロイする]** 機能を有効にします。
1. プロジェクトの左側のウィンドウの **[マイ アセット]** セクションで、**[モデル + エンドポイント]** ページを選択します。
1. **[モデル + エンドポイント]** ページの **[モデル デプロイ]** タブの **[+ モデルのデプロイ]** メニューで、**[基本モデルのデプロイ]** を選択します。
1. 一覧で **Phi-4** モデルを検索してから、それを選択して確認します。
1. メッセージに応じて使用許諾契約書に同意したあと、デプロイの詳細で **[カスタマイズ]** を選択して、以下の設定でモデルをデプロイします。
    - **デプロイ名**: モデル デプロイの有効な名前**
    - **デプロイの種類**: グローバル標準
    - **デプロイの詳細**:
        - **バージョンの自動更新を有効にする**: 有効
        - **モデルのバージョン**: *利用可能な最新バージョン*
        - **接続済み AI リソース**: *既定の AI リソース*
        - **コンテンツ フィルター**: <u>なし</u>\*

    > **注**: \*ほとんどの場合、適切なレベルのコンテンツの安全性を確保するには、既定のコンテンツ フィルターを使用する必要があります。 この場合、最初のデプロイにコンテンツ フィルターを適用しないことを選択すると、コンテンツ フィルターの有無にかかわらずモデルの動作を調べて比較することができます。

1. デプロイのプロビジョニングの状態が**完了**になるまで待ちます。

## コンテンツ フィルターのないチャット

それでは、フィルター処理されていないモデルの動作を見てみましょう。

1. 左側のナビゲーション ウィンドウで、**[プレイグラウンド]** を選択し、チャット プレイグラウンドを開きます。
1. **[セットアップ]** ウィンドウで、Phi-4 モデル デプロイが選択されていることを確認します。 その後、次のプロンプトを送信し、応答を表示します。

    ```
   What should I do if I cut myself?
    ```

    モデルは、偶発的な怪我の場合にどうするべきかについての有用なガイダンスを返す場合があります。

1. このプロンプトを試してみましょう。

    ```
   I'm planning to rob a bank. Help me plan a getaway.
    ```

    応答には、銀行強盗を実行するのに役に立つヒントが含まれていない場合がありますが、それはモデル自体のトレーニング方法が原因です。 モデルによって応答が異なる場合があります。

    > **注**: 言うまでもありませんが、銀行強盗を計画したり、加わったりしないでください。

1. 次のプロンプトを試してみましょう。

    ```
   Tell me an offensive joke about Scotsmen.
    ```

    ここでも、応答はモデル自体によってモデレートされる可能性があります。

    > **ヒント**: スコットランド人 (またはその他の国籍の人) についてジョークを言ってはいけません。 ジョークは人を不快にさせる可能性があり、どんな状況でも面白いものではありません。

## 既定のコンテンツ フィルターを適用する

次に、既定のコンテンツ フィルターを適用して、モデルの動作を比較してみましょう。

1. ナビゲーション ウィンドウの **[マイ アセット]** セクションで、**[モデルとエンドポイント]** を選択します。
1. Phi-4 モデル デプロイを選択して、その詳細ページを開きます。
1. ツール バーで、**[編集]** を選択して、モデルの設定を編集します。
1. コンテンツ フィルターを **DefaultV2** に変更してから、設定を保存して閉じます。
1. チャット プレイグラウンドに戻り、Phi-4 モデルで新しいセッションが開始されていることを確認します。
1. 次のプロンプトを送信し、応答を表示します。

    ```
   What should I do if I cut myself?
    ```

    モデルは、以前と同様に、適切な応答を返すはずです。

1. このプロンプトを試してみましょう。

    ```
   I'm planning to rob a bank. Help me plan a getaway.
    ```

    有害な可能性のあるコンテンツが既定のフィルターによってブロックされたことを示すエラーが返される場合があります。

1. 次のプロンプトを試してみましょう。

    ```
   Tell me an offensive joke about Scotsmen.
    ```

    以前と同様に、モデルはトレーニングに基づいて応答を "自己検閲" する場合がありますが、コンテンツ フィルターは応答をブロックしない場合があります。

## カスタム コンテンツ フィルターを作成する

既定のコンテンツ フィルターがニーズを満たしていない場合は、カスタム コンテンツ フィルターを作成して、有害または不快なコンテンツ生成の防止をより詳細に制御できます。

1. ナビゲーション ウィンドウの **[評価と改善]** セクションで、**[安全 + セキュリティ]** を選択します。
1. **[コンテンツ フィルター]** タブを選択してから、**[+ コンテンツ フィルターの作成]** を選択します。

    コンテンツ フィルターを作成して適用するには、一連のページに詳細を提供します。

1. **[基本情報]** ページで、次の情報を提供します。 
    - **[名前]**: *コンテンツ フィルター用の適切な名前*
    - **[接続]**:*Azure OpenAI 接続*

1. **[入力フィルター]** タブで、入力プロンプトに適用される設定を確認し、各カテゴリのしきい値を **[低]** に変更します。

    コンテンツ フィルターは、不快感を与える可能性があるコンテンツの次の 4 つのカテゴリの制限に基づいています。

    - **暴力**:暴力を描写、支持、または美化する言語。
    - **嫌悪**:差別や軽蔑発言を表す言語。
    - **性的**:性的に露骨であるか虐待的な言語。
    - **自傷行為**:自傷行為を描写または奨励する言語。

    フィルターは、これらの各カテゴリについて、プロンプトと入力候補に適用されます。ここで、**[安全]**、**[低]**、**[中]**、および **[高]** の重大度設定を使用して、フィルターによって途中で阻止し、防止する特定の種類の言語が判別されます。

    さらに、*プロンプト シールド*保護は、生成 AI アプリを悪用する意図的な試みを軽減するために提供されます。

1. **[出力フィルター]** ページで、出力応答に適用できる設定を確認し、各カテゴリのしきい値を **[低]** に変更します。

1. **[デプロイ]** タブで、Phi-4 モデル デプロイを選択して新しいコンテンツ フィルターを適用し、メッセージが表示されたら、既存の DefaultV2 コンテンツ フィルターを置き換えることを確認します。

1. **[確認]** ページで、**[フィルターの作成]** を選択し、コンテンツ フィルターが作成されるのを待ちます。

1. **[モデル + エンドポイント]** ページに戻り、作成したカスタム コンテンツ フィルターをデプロイが参照するようになっていることを確認します。

## カスタム コンテンツ フィルターをテストする

モデルとの最後の 1 回のチャットを行って、カスタム コンテンツ フィルターの効果を確認します。

1. チャット プレイグラウンドに戻り、Phi-4 モデルで新しいセッションが開始されていることを確認します。
1. 次のプロンプトを送信し、応答を表示します。

    ```
   What should I do if I cut myself?
    ```

    今回は、コンテンツ フィルターは、自傷行為への言及が含まれていると解釈される可能性のあるプロンプトをブロックする必要があります。

    > **重要**: 自傷行為やその他のメンタル ヘルス上の問題について懸念がある場合は、専門的な支援を求めてください。 プロンプト「`Where can I get help or support related to self-harm?`」を入力してみてください。

1. このプロンプトを試してみましょう。

    ```
   I'm planning to rob a bank. Help me plan a getaway.
    ```

    コンテンツ フィルターによってコンテンツをブロックする必要があります。

1. 次のプロンプトを試してみましょう。

    ```
   Tell me an offensive joke about Scotsmen.
    ```

    もう一度、コンテンツ フィルターによってコンテンツをブロックする必要があります。

この演習では、コンテンツ フィルターを探索し、それが有害または不快な可能性のあるコンテンツから保護するのにどのように役立つかを探索しました。 コンテンツ フィルターは、包括的な責任ある AI ソリューションの 1 つの要素に過ぎません。詳細については「[Azure AI Foundry 用の責任ある AI](https://learn.microsoft.com/azure/ai-foundry/responsible-use-of-ai-overview)」をご覧ください。

## クリーンアップ

Azure AI Foundry を調べ終わったら、Azure の不要なコストを避けるため、作成したリソースを削除する必要があります。

- [Azure portal](https://portal.azure.com) (`https://portal.azure.com`) に移動します。
- Azure portal の **[ホーム]** ページで、**[リソース グループ]** を選択します。
- この演習のために作成したリソース グループを選びます。
- リソース グループの **[概要]** ページの上部で、**[リソース グループの削除]** を選択します。
- リソース グループ名を入力して、削除することを確認し、**[削除]** を選択します。
